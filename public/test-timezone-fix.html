<!DOCTYPE html>
<html>
<head>
    <title>Test Auto PZEM Timezone Fix</title>
</head>
<body>
    <div style="padding: 20px; font-family: Arial;">
        <h2>üîß Debug Auto PZEM Timezone Fix</h2>
        <div id="debugInfo" style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 10px 0;">
            <h3>Time Information:</h3>
            <div id="timeInfo"></div>
        </div>
        
        <div id="powerInfo" style="background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 10px 0;">
            <h3>Power Generation Logic:</h3>
            <div id="powerDebug"></div>
        </div>
        
        <button onclick="testTimeLogic()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
            üß™ Test Current Time Logic
        </button>
    </div>

    <script>
        function testTimeLogic() {
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            
            // Display current time info
            document.getElementById('timeInfo').innerHTML = `
                <strong>Local Time:</strong> ${now.toString()}<br>
                <strong>Hour:</strong> ${hour}<br>
                <strong>Minute:</strong> ${minute}<br>
                <strong>Is Weekend:</strong> ${[0, 6].includes(now.getDay())}<br>
                <strong>Day of Week:</strong> ${now.getDay()} (0=Sunday, 6=Saturday)
            `;
            
            // Test power generation logic
            let powerCategory = '';
            let expectedPower = '';
            let isNightTime = false;
            
            const isWeekend = [0, 6].includes(now.getDay());
            
            // Working hours logic (same as fixed auto-pzem-values.js)
            if (hour >= 7 && hour <= 18 && !isWeekend) {
                powerCategory = 'üè¢ Working Hours';
                expectedPower = '550-600W (High consumption)';
            } else if (isWeekend && hour >= 8 && hour <= 17) {
                powerCategory = 'üèñÔ∏è Weekend Daytime';
                expectedPower = '300-400W (Medium consumption)';
            } else {
                powerCategory = 'üåÉ Night/Off Hours';
                expectedPower = '120-180W (Low consumption)';
            }
            
            // Night reduction logic (fixed)
            isNightTime = (hour >= 22 || hour < 6);
            
            document.getElementById('powerDebug').innerHTML = `
                <strong>Time Category:</strong> ${powerCategory}<br>
                <strong>Expected Power Range:</strong> ${expectedPower}<br>
                <strong>Night Time (22:00-06:00):</strong> ${isNightTime ? 'üåô YES' : '‚òÄÔ∏è NO'}<br>
                <strong>Night Reduction Applied:</strong> ${isNightTime ? 'YES (-70%)' : 'NO'}<br>
                <br>
                <div style="padding: 10px; background: ${hour >= 16 && hour <= 18 ? '#c8e6c9' : '#ffcdd2'}; border-radius: 3px;">
                    <strong>‚úÖ Current Status (${hour}:${minute < 10 ? '0' + minute : minute}):</strong><br>
                    ${hour >= 16 && hour <= 18 ? 
                        'üî• Should generate HIGH power (550-600W) - Still working hours!' : 
                        '‚ÑπÔ∏è Power level depends on exact hour'}
                </div>
            `;
            
            console.log('üîß Debug Test Results:', {
                currentHour: hour,
                isWorkingHour: hour >= 7 && hour <= 18 && !isWeekend,
                isNightTime: isNightTime,
                shouldBeHighPower: hour >= 7 && hour <= 18 && !isWeekend
            });
        }
        
        // Auto-run test on page load
        window.onload = testTimeLogic;
        
        // Update every 5 seconds
        setInterval(testTimeLogic, 5000);
    </script>
</body>
</html>
